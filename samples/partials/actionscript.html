<p>Default language reference: <b>actionscript</b></p>
<pre class="language-actionscript"><code class="language-actionscript">
<span class="token comment" spellcheck="true">// Single line comment
</span><span class="token comment" spellcheck="true">/* Multi-line
comment */</span>

<span class="token keyword">class</span> <span class="token class-name function">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name function">B</span> <span class="token keyword">extends</span> <span class="token class-name function">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">package</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span> flash<span class="token punctuation">.</span>display<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> flash<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> flash<span class="token punctuation">.</span>filters<span class="token punctuation">.</span>BlurFilter<span class="token punctuation">;</span>
  <span class="token keyword">import</span> flash<span class="token punctuation">.</span>geom<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> flash<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name function">ch23ex2</span> <span class="token keyword">extends</span> <span class="token class-name function">Sprite</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">const</span> BMP_SCALE<span class="token punctuation">:</span>Number <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">const</span> D<span class="token punctuation">:</span>Number <span class="token operator">=</span> <span class="token number">1.015</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">const</span> DIM_EFFECT<span class="token punctuation">:</span>ColorTransform <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">ColorTransform</span><span class="token punctuation">(</span>D<span class="token punctuation">,</span> D<span class="token punctuation">,</span> D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">const</span> B<span class="token punctuation">:</span>int <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">const</span> BLUR_EFFECT<span class="token punctuation">:</span>BlurFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">BlurFilter</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span> B<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">var</span> RLUT<span class="token punctuation">:</span>Array<span class="token punctuation">,</span> GLUT<span class="token punctuation">:</span>Array<span class="token punctuation">,</span> BLUT<span class="token punctuation">:</span>Array<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">var</span> sourceBmp<span class="token punctuation">:</span>BitmapData<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">var</span> colorBmp<span class="token punctuation">:</span>BitmapData<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">var</span> touches<span class="token punctuation">:</span>Array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">var</span> fingerShape<span class="token punctuation">:</span>Shape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Shape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ch23ex2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> test<span class="token punctuation">:</span>Class <span class="token operator">=</span> Multitouch<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Multitouch<span class="token punctuation">.</span>supportsTouchEvents<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Multitouch<span class="token punctuation">.</span>inputMode <span class="token operator">=</span> MultitouchInputMode<span class="token punctuation">.</span>TOUCH_POINT<span class="token punctuation">;</span>
          <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Sorry, this example requires multitouch."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name function">error</span><span class="token punctuation">:</span>ReferenceError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Sorry, but multitouch is not supported in this runtime."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">void</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">//create a black-and-white bitmap and a color bitmap, only show the color
</span>      sourceBmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">BitmapData</span><span class="token punctuation">(</span>
        stage<span class="token punctuation">.</span>stageWidth<span class="token operator">*</span>BMP_SCALE<span class="token punctuation">,</span> stage<span class="token punctuation">.</span>stageHeight<span class="token operator">*</span>BMP_SCALE<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      colorBmp <span class="token operator">=</span> sourceBmp<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> bitmap<span class="token punctuation">:</span>Bitmap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Bitmap</span><span class="token punctuation">(</span>colorBmp<span class="token punctuation">,</span> PixelSnapping<span class="token punctuation">.</span>ALWAYS<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bitmap<span class="token punctuation">.</span>width <span class="token operator">=</span> stage<span class="token punctuation">.</span>stageWidth<span class="token punctuation">;</span> bitmap<span class="token punctuation">.</span>height <span class="token operator">=</span> stage<span class="token punctuation">.</span>stageHeight<span class="token punctuation">;</span>
      <span class="token function">addChild</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">//create finger shape to paste onto the bitmap under your touches
</span>      fingerShape<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">beginFill</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fingerShape<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">drawEllipse</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fingerShape<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">endFill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">//create the palette map from a gradient
</span>      <span class="token keyword">var</span> gradient<span class="token punctuation">:</span>Shape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Shape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> m<span class="token punctuation">:</span>Matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      m<span class="token punctuation">.</span><span class="token function">createGradientBox</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      gradient<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">beginGradientFill</span><span class="token punctuation">(</span>GradientType<span class="token punctuation">.</span>LINEAR<span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">0x313ad8</span><span class="token punctuation">,</span> <span class="token number">0x2dce4a</span><span class="token punctuation">,</span> <span class="token number">0xdae234</span><span class="token punctuation">,</span> <span class="token number">0x7a1c1c</span><span class="token punctuation">,</span> <span class="token number">0x0f0303</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token operator">*</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token operator">*</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token operator">*</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gradient<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> gradientBmp<span class="token punctuation">:</span>BitmapData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">BitmapData</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      gradientBmp<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>gradient<span class="token punctuation">)</span><span class="token punctuation">;</span>
      RLUT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> GLUT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> BLUT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token punctuation">:</span>int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> pixelColor<span class="token punctuation">:</span>uint <span class="token operator">=</span> gradientBmp<span class="token punctuation">.</span><span class="token function">getPixel</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//I drew the gradient backwards, so sue me
</span>        RLUT<span class="token punctuation">[</span><span class="token number">256</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pixelColor <span class="token operator">&amp;</span> <span class="token number">0xff0000</span><span class="token punctuation">;</span>
        GLUT<span class="token punctuation">[</span><span class="token number">256</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pixelColor <span class="token operator">&amp;</span> <span class="token number">0x00ff00</span><span class="token punctuation">;</span>
        BLUT<span class="token punctuation">[</span><span class="token number">256</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pixelColor <span class="token operator">&amp;</span> <span class="token number">0x0000ff</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      stage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>TouchEvent<span class="token punctuation">.</span>TOUCH_BEGIN<span class="token punctuation">,</span> assignTouch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      stage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>TouchEvent<span class="token punctuation">.</span>TOUCH_MOVE<span class="token punctuation">,</span> assignTouch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      stage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>TouchEvent<span class="token punctuation">.</span>TOUCH_END<span class="token punctuation">,</span> removeTouch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      stage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>Event<span class="token punctuation">.</span>ENTER_FRAME<span class="token punctuation">,</span> onEnterFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">assignTouch</span><span class="token punctuation">(</span>event<span class="token punctuation">:</span>TouchEvent<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">void</span> <span class="token punctuation">{</span>
      touches<span class="token punctuation">[</span>event<span class="token punctuation">.</span>touchPointID<span class="token punctuation">]</span> <span class="token operator">=</span> event<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">removeTouch</span><span class="token punctuation">(</span>event<span class="token punctuation">:</span>TouchEvent<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">void</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> touches<span class="token punctuation">[</span>event<span class="token punctuation">.</span>touchPointID<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">onEnterFrame</span><span class="token punctuation">(</span>event<span class="token punctuation">:</span>Event<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">void</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key<span class="token punctuation">:</span>String <span class="token keyword">in</span> touches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> touch<span class="token punctuation">:</span>TouchEvent <span class="token operator">=</span> touches<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token keyword">as</span> TouchEvent<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>touch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">//plaster the finger image under your finger
</span>          <span class="token keyword">var</span> m<span class="token punctuation">:</span>Matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          m<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>touch<span class="token punctuation">.</span>stageX<span class="token operator">*</span>BMP_SCALE<span class="token punctuation">,</span> touch<span class="token punctuation">.</span>stageY<span class="token operator">*</span>BMP_SCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>
          sourceBmp<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>fingerShape<span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> BlendMode<span class="token punctuation">.</span>ADD<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">var</span> O<span class="token punctuation">:</span>Point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name function">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//blur and ever-so-slightly brighten the image to make the color last
</span>      sourceBmp<span class="token punctuation">.</span><span class="token function">applyFilter</span><span class="token punctuation">(</span>sourceBmp<span class="token punctuation">,</span> sourceBmp<span class="token punctuation">.</span>rect<span class="token punctuation">,</span> O<span class="token punctuation">,</span> BLUR_EFFECT<span class="token punctuation">)</span><span class="token punctuation">;</span>
      sourceBmp<span class="token punctuation">.</span><span class="token function">colorTransform</span><span class="token punctuation">(</span>sourceBmp<span class="token punctuation">.</span>rect<span class="token punctuation">,</span> DIM_EFFECT<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//we've calculated the image in grayscale brightnesses, now make it color
</span>      colorBmp<span class="token punctuation">.</span><span class="token function">paletteMap</span><span class="token punctuation">(</span>sourceBmp<span class="token punctuation">,</span> sourceBmp<span class="token punctuation">.</span>rect<span class="token punctuation">,</span> O<span class="token punctuation">,</span> RLUT<span class="token punctuation">,</span> GLUT<span class="token punctuation">,</span> BLUT<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
