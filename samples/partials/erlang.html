<p>Default language reference: <b>erlang</b></p>
<pre class="language-"><code class="language-"><span class="token operator">-</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token atom">ssh_cli</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token operator">-</span><span class="token function">behaviour</span><span class="token punctuation">(</span><span class="token atom">ssh_channel</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token operator">-</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token string">"ssh.hrl"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token comment" spellcheck="true">%% backwards compatibility</span>
<span class="token operator">-</span><span class="token function">export</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token atom">listen</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token atom">listen</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token atom">listen</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token atom">listen</span><span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token atom">stop</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token keyword">if</span> <span class="token variable">L</span> <span class="token operator">=/=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">&gt;</span>      <span class="token comment" spellcheck="true">% If L is not empty</span>
    <span class="token function">sum</span><span class="token punctuation">(</span><span class="token variable">L</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token boolean">true</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token atom">error</span>
<span class="token keyword">end</span><span class="token punctuation">.</span>

<span class="token comment" spellcheck="true">%% state</span>
<span class="token operator">-</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token atom">state</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token atom">cm</span><span class="token punctuation">,</span>
    <span class="token atom">channel</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token operator">-</span><span class="token atom">spec</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token variable">X</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token variable">X</span><span class="token punctuation">.</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token variable">Foo</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token variable">Foo</span><span class="token punctuation">.</span>

<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">Shell</span><span class="token punctuation">,</span> <span class="token variable">Exec</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token atom">ok</span><span class="token punctuation">,</span> <span class="token punctuation">#</span><span class="token atom">state</span><span class="token punctuation">{</span><span class="token atom">shell</span> <span class="token operator">=</span> <span class="token variable">Shell</span><span class="token punctuation">,</span> <span class="token atom">exec</span> <span class="token operator">=</span> <span class="token variable">Exec</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">Shell</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token boolean">false</span> <span class="token operator">=</span> <span class="token operator">not</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token atom">io</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Hello, \"~p!~n"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">atom_to_list</span><span class="token punctuation">(</span><span class="token quoted-atom atom">'World'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token atom">ok</span><span class="token punctuation">,</span> <span class="token punctuation">#</span><span class="token atom">state</span><span class="token punctuation">{</span><span class="token atom">shell</span> <span class="token operator">=</span> <span class="token variable">Shell</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">.</span>

<span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">Single</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">Single</span><span class="token punctuation">;</span>
<span class="token function">concat</span><span class="token punctuation">(</span><span class="token variable">RList</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">EpsilonFree</span> <span class="token operator">=</span> <span class="token atom">lists</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span>
        <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token variable">Element</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token keyword">case</span> <span class="token variable">Element</span> <span class="token keyword">of</span>
                <span class="token atom">epsilon</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token variable">_</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">true</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span><span class="token punctuation">,</span>
        <span class="token variable">RList</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">case</span> <span class="token variable">EpsilonFree</span> <span class="token keyword">of</span>
        <span class="token punctuation">[</span><span class="token variable">Single</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token variable">Single</span><span class="token punctuation">;</span>
        <span class="token variable">Other</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token atom">concat</span><span class="token punctuation">,</span> <span class="token variable">Other</span><span class="token punctuation">}</span>
    <span class="token keyword">end</span><span class="token punctuation">.</span>

<span class="token function">union_dot_union</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token atom">union</span><span class="token punctuation">,</span> <span class="token variable">_</span><span class="token punctuation">}</span><span class="token operator">=</span><span class="token variable">U1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token atom">union</span><span class="token punctuation">,</span> <span class="token variable">_</span><span class="token punctuation">}</span><span class="token operator">=</span><span class="token variable">U2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token function">union</span><span class="token punctuation">(</span><span class="token atom">lists</span><span class="token punctuation">:</span><span class="token function">flatten</span><span class="token punctuation">(</span>
        <span class="token atom">lists</span><span class="token punctuation">:</span><span class="token function">map</span><span class="token punctuation">(</span>
            <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token variable">X1</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
                <span class="token atom">lists</span><span class="token punctuation">:</span><span class="token function">map</span><span class="token punctuation">(</span>
                    <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token variable">X2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
                        <span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">X1</span><span class="token punctuation">,</span> <span class="token variable">X2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">end</span><span class="token punctuation">,</span>
                    <span class="token function">union_to_list</span><span class="token punctuation">(</span><span class="token variable">U2</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token keyword">end</span><span class="token punctuation">,</span>
            <span class="token function">union_to_list</span><span class="token punctuation">(</span><span class="token variable">U1</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

</code></pre>
